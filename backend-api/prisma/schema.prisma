generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  user_id      Int      @id @default(autoincrement())
  username     String   @unique @db.VarChar(100)
  email        String   @unique @db.VarChar(100)
  password     String   @db.VarChar(255)
  phone_number String   @db.VarChar(20)
  created_at   DateTime @default(now())
  role_id      Int
  role         Role     @relation(fields: [role_id], references: [role_id])

  // Customer relations
  bookings Booking[]
  reviews  Review[]

  // Cleaner relations (FIXED)
  cleaner_bookings Booking[] @relation("cleaner_bookings")
  cleaner_reviews  Review[]  @relation("cleaner_reviews")

  notifications Notification[]
  setting       Setting?
}

model Role {
  role_id     Int              @id @default(autoincrement())
  role_name   String           @unique @db.VarChar(50)
  users       User[]
  permissions RolePermission[]
}

model RolePermission {
  id              Int    @id @default(autoincrement())
  permission_name String @db.VarChar(100)
  role_id         Int
  role            Role   @relation(fields: [role_id], references: [role_id])
}

model Service {
  service_id  Int            @id @default(autoincrement())
  name        String         @db.VarChar(100)
  price       Float
  description String         @db.Text
  bookings    Booking[]
  images      ServiceImage[]
}

model ServiceImage {
  id         Int     @id @default(autoincrement())
  image_url  String  @db.Text
  service_id Int
  service    Service @relation(fields: [service_id], references: [service_id])
}

model Booking {
  booking_id     Int      @id @default(autoincrement())
  booking_date   DateTime
  booking_status String   @db.VarChar(50)
  total_price    Float
  payment_status String   @db.VarChar(50)
  created_at     DateTime @default(now())
  user_id        Int
  cleaner_id     Int?
  service_id     Int
  promotion_id   Int?

  user      User       @relation(fields: [user_id], references: [user_id])
  cleaner   User?      @relation("cleaner_bookings", fields: [cleaner_id], references: [user_id])
  service   Service    @relation(fields: [service_id], references: [service_id])
  promotion Promotion? @relation(fields: [promotion_id], references: [promotion_id])

  review        Review?
  payment       Payment?
  notifications Notification[]
}

model Promotion {
  promotion_id   Int       @id @default(autoincrement())
  discount_price Float
  start_date     DateTime
  end_date       DateTime
  bookings       Booking[]
}

model Review {
  review_id  Int      @id @default(autoincrement())
  rating     Int
  command    String   @db.Text
  created_at DateTime @default(now())
  booking_id Int      @unique
  user_id    Int
  cleaner_id Int?

  booking Booking @relation(fields: [booking_id], references: [booking_id])
  user    User    @relation(fields: [user_id], references: [user_id])
  cleaner User?   @relation("cleaner_reviews", fields: [cleaner_id], references: [user_id])
}

model Payment {
  payment_id     Int    @id @default(autoincrement())
  amount         Float
  payment_method String @db.VarChar(50)
  payment_status String @db.VarChar(50)
  booking_id     Int    @unique

  booking Booking @relation(fields: [booking_id], references: [booking_id])
}

model Notification {
  notification_id   Int      @id @default(autoincrement())
  title             String   @db.VarChar(200)
  message           String   @db.Text
  type_notification String   @db.VarChar(50)
  is_read           Boolean  @default(false)
  created_at        DateTime @default(now())
  user_id           Int
  booking_id        Int?

  user    User     @relation(fields: [user_id], references: [user_id])
  booking Booking? @relation(fields: [booking_id], references: [booking_id])
}

model Setting {
  setting_id           Int      @id @default(autoincrement())
  language             String   @default("en") @db.VarChar(10)
  notification_enabled Boolean  @default(true)
  dark_mode            Boolean  @default(false)
  updated_at           DateTime @updatedAt
  user_id              Int      @unique

  user User @relation(fields: [user_id], references: [user_id])
}
